# CaminhoDev Backend

Bem-vindo ao backend da plataforma **CaminhoDev**! Este sistema √© constru√≠do com **Node.js**, **Fastify**, **Prisma** e **PostgreSQL**, e foi projetado para ser robusto, escal√°vel e f√°cil de manter.

## ‚ú® Features

* **Autentica√ß√£o e Gerenciamento de Usu√°rios**: Sistema completo de cadastro, login (com JWT e Cookies) e gerenciamento de perfis e permiss√µes (usu√°rio e administrador).
* **Gest√£o de Conte√∫do Educacional**: CRUD completo para Mat√©rias (Subjects), T√≥picos (Topics) e Conte√∫dos (Contents).
* **Acompanhamento de Progresso**: Rastreia o progresso de estudo dos usu√°rios por mat√©ria e t√≥pico, al√©m de registrar o √∫ltimo acesso.
* **Estat√≠sticas de Usu√°rio**: Fornece dados sobre o desempenho do usu√°rio, como tempo de estudo, mat√©rias e t√≥picos conclu√≠dos.
* **Conte√∫dos Salvos**: Permite que os usu√°rios salvem conte√∫dos para visualiza√ß√£o posterior.

## üöÄ Tecnologias Utilizadas

Este projeto utiliza uma variedade de tecnologias modernas para garantir uma base s√≥lida e uma √≥tima experi√™ncia de desenvolvimento.

| Categoria              | Tecnologia                                                                                                                                                                                              |
| :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Backend** | Node.js, Fastify, TypeScript                                                                                                                                                                            |
| **Banco de Dados** | PostgreSQL                                                                                                 |
| **ORM** | Prisma                                                                                                               |
| **Containeriza√ß√£o** | Docker, Docker Compose                                                                                      |
| **Testes** | Jest, ts-jest                                                                                                 |
| **Linting & Formata√ß√£o** | ESLint, Prettier, Lint-Staged, Husky                                                                      |
| **Valida√ß√£o** | Zod                                                                                                               |
| **Autentica√ß√£o** | JWT, Bcrypt                                                                                                     |

<br>

## ‚öôÔ∏è Configura√ß√£o do Ambiente

Siga os passos abaixo para configurar e executar o ambiente de desenvolvimento.

### Pr√©-requisitos

* [Docker](https://www.docker.com/products/docker-desktop/) e [Docker Compose](https://docs.docker.com/compose/install/)
* [Node.js](https://nodejs.org/) (para desenvolvimento local e execu√ß√£o de scripts)
* [Git](https://git-scm.com/)

### Iniciando o Projeto

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone git@github.com:Engenharia-II/backend.git
    cd backend
    ```

2.  **Instale as depend√™ncias:**
    ```bash
    npm install
    ```

3.  **Inicie os containers Docker:**
    ```bash
    docker-compose up -d
    ```
    Este comando ir√° iniciar:
    * O servi√ßo da **API** na porta `3333`.
    * O banco de dados **PostgreSQL** na porta `5432`.
    * A execu√ß√£o autom√°tica das migrations e seeding do banco.

4.  **Popule o banco com dados iniciais (opcional):**
    Para preencher o banco com mat√©rias, t√≥picos e conte√∫dos de exemplo, execute:
    ```bash
    npm run db:populate
    ```
   

## üìú Scripts Dispon√≠veis

O projeto conta com diversos scripts para facilitar o desenvolvimento, definidos no arquivo `package.json`:

| Comando              | Descri√ß√£o                                                                                          |
| :------------------- | :------------------------------------------------------------------------------------------------- |
| `npm run dev`        | Inicia o servidor em modo de desenvolvimento com hot-reload (`tsx`).                               |
| `npm run build`      | Compila o c√≥digo TypeScript para JavaScript (`dist/`).                                               |
| `npm run start`      | Inicia o servidor em modo de produ√ß√£o a partir dos arquivos compilados.                            |
| `npm run lint`       | Executa o ESLint para verificar a qualidade do c√≥digo.                                             |
| `npm run lint:fix`   | Corrige automaticamente os problemas de lint que forem poss√≠veis.                                  |
| `npm run format`     | Formata todo o c√≥digo do projeto com o Prettier.                                                   |
| `npm test`           | Roda a su√≠te de testes com o Jest.                                                                 |
| `npm run prisma:migrate` | Cria uma nova migration do Prisma com base nas altera√ß√µes do schema.                               |
| `npm run prisma:deploy`  | Aplica as migrations pendentes no banco de dados.                                                  |
| `npm run prisma:studio`| Abre a interface visual do Prisma para gerenciamento do banco.                                     |
| `npm run prisma:seed`| Executa o script de seeding (`prisma/seed.ts`) para popular dados essenciais (roles, admin).        |
| `npm run db:populate`| Roda o script para popular o banco com dados de mat√©rias e conte√∫dos (`prisma/scripts/populate.js`). |

<br>

## üóÑÔ∏è Gest√£o do Banco de Dados

O projeto utiliza o **Prisma** como ORM. As migrations s√£o gerenciadas para garantir a consist√™ncia do schema do banco.

* **Schema**: A defini√ß√£o do banco de dados est√° no arquivo `prisma/schema.prisma`.
* **Migrations**: Para criar uma nova migration ap√≥s alterar o `schema.prisma`, use:
    ```bash
    docker-compose exec api npx prisma migrate dev --name <nome_da_migration>
    ```
* **Prisma Studio**: Para visualizar e editar os dados diretamente no banco de maneira gr√°fica:
    ```bash
    docker-compose exec api npx prisma studio
    ```
    O Studio estar√° acess√≠vel em `http://localhost:5555`.

## üìö Rotas da API

A documenta√ß√£o completa e interativa da API est√° dispon√≠vel em `http://localhost:3333/docs` quando o servidor est√° rodando. Abaixo est√° um resumo das rotas dispon√≠veis.

*Observa√ß√£o: Rotas marcadas com üîí requerem autentica√ß√£o.*

---

### Autentica√ß√£o (`/sessions`)

| M√©todo | Rota         | Descri√ß√£o                                         | Auth |
| :----- | :----------- | :------------------------------------------------ | :--- |
| `POST` | `/sign-up`   | Cria uma nova conta de usu√°rio.                   | üîì    |
| `POST` | `/login`     | Autentica um usu√°rio e retorna um token JWT.      | üîì    |
| `POST` | `/logout`    | Limpa o cookie de autentica√ß√£o do usu√°rio.        | üîí    |

---

### Usu√°rios (`/users`)

| M√©todo   | Rota               | Descri√ß√£o                                      | Auth |
| :------- | :----------------- | :--------------------------------------------- | :--- |
| `GET`    | `/get-by-id`       | Retorna os dados do usu√°rio autenticado.       | üîí    |
| `GET`    | `/list-all`        | Lista todos os usu√°rios (apenas admin).        | üîí    |
| `PUT`    | `/update`          | Atualiza as informa√ß√µes do usu√°rio autenticado. | üîí    |
| `DELETE` | `/delete/:id`      | Deleta um usu√°rio (apenas admin).              | üîí    |
| `PUT`    | `/last-app-access` | Atualiza a data do √∫ltimo acesso do usu√°rio.   | üîí    |
| `GET`    | `/statistics`      | Retorna as estat√≠sticas de estudo do usu√°rio.  | üîí    |

---

### Mat√©rias (`/subjects`)

| M√©todo   | Rota             | Descri√ß√£o                                                        | Auth |
| :------- | :--------------- | :--------------------------------------------------------------- | :--- |
| `POST`   | `/create`        | Cria uma nova mat√©ria (apenas admin).                            | üîí    |
| `GET`    | `/`              | Lista todas as mat√©rias.                                         | üîí    |
| `GET`    | `/:id`           | Retorna uma mat√©ria espec√≠fica pelo ID.                          | üîí    |
| `GET`    | `/:id/details`   | Retorna os detalhes de uma mat√©ria, incluindo t√≥picos e progresso. | üîí    |
| `GET`    | `/:id/topics`    | Lista todos os t√≥picos de uma mat√©ria.                           | üîì    |
| `PUT`    | `/:id`           | Atualiza uma mat√©ria (apenas admin).                             | üîí    |
| `DELETE` | `/:id`           | Deleta uma mat√©ria (apenas admin).                               | üîí    |
| `GET`    | `/progress`      | Lista todas as mat√©rias com o progresso do usu√°rio.              | üîí    |

---

### T√≥picos (`/topics`)

| M√©todo   | Rota           | Descri√ß√£o                             | Auth |
| :------- | :------------- | :------------------------------------ | :--- |
| `POST`   | `/create`      | Cria um novo t√≥pico (apenas admin).   | üîí    |
| `GET`    | `/`            | Lista todos os t√≥picos.               | üîí    |
| `GET`    | `/:id`         | Retorna um t√≥pico espec√≠fico pelo ID. | üîí    |
| `GET`    | `/:id/contents`| Lista todos os conte√∫dos de um t√≥pico.| üîí    |
| `PUT`    | `/:id`         | Atualiza um t√≥pico (apenas admin).    | üîí    |
| `DELETE` | `/:id`         | Deleta um t√≥pico (apenas admin).      | üîí    |

---

### Conte√∫dos (`/contents`)

| M√©todo   | Rota      | Descri√ß√£o                               | Auth |
| :------- | :-------- | :-------------------------------------- | :--- |
| `POST`   | `/create` | Cria um novo conte√∫do (apenas admin).   | üîí    |
| `GET`    | `/`       | Lista todos os conte√∫dos.               | üîí    |
| `GET`    | `/:id`    | Retorna um conte√∫do espec√≠fico pelo ID. | üîí    |
| `PUT`    | `/:id`    | Atualiza um conte√∫do (apenas admin).    | üîí    |
| `DELETE` | `/:id`    | Deleta um conte√∫do (apenas admin).      | üîí    |

---

### Progresso e Acessos

| M√©todo   | Rota          | Prefixo             | Descri√ß√£o                                       |
| :------- | :------------ | :------------------ | :---------------------------------------------- |
| `PUT`    | `/`           | `/subject-study`    | Atualiza o status de estudo de uma mat√©ria.     |
| `GET`    | `/`           | `/subject-study`    | Lista o progresso de estudo das mat√©rias do usu√°rio.|
| `DELETE` | `/`           | `/subject-study`    | Remove o progresso de estudo de uma mat√©ria.    |
| `PUT`    | `/`           | `/topic-study`      | Atualiza o status de estudo de um t√≥pico.       |
| `GET`    | `/`           | `/topic-study`      | Lista o progresso de estudo dos t√≥picos do usu√°rio. |
| `DELETE` | `/`           | `/topic-study`      | Remove o progresso de estudo de um t√≥pico.      |
| `PUT`    | `/`           | `/subject-access`   | Atualiza o √∫ltimo acesso a uma mat√©ria.         |
| `GET`    | `/`           | `/subject-access`   | Lista os √∫ltimos acessos √†s mat√©rias.           |
| `PUT`    | `/`           | `/topic-access`     | Atualiza o √∫ltimo acesso a um t√≥pico.           |
| `GET`    | `/`           | `/topic-access`     | Lista os √∫ltimos acessos aos t√≥picos.           |
| `POST`   | `/save`       | `/saved-content`    | Salva um conte√∫do para o usu√°rio.               |
| `DELETE` | `/remove`     | `/saved-content`    | Remove um conte√∫do salvo.                       |
| `GET`    | `/by-user-id` | `/saved-content`    | Lista os conte√∫dos salvos pelo usu√°rio.         |

*Todas as rotas de progresso e acesso s√£o autenticadas* üîí.

## üìÅ Estrutura do Projeto

```
.
‚îú‚îÄ‚îÄ prisma/               # Schema, migrations e scripts do banco
‚îÇ   ‚îú‚îÄ‚îÄ migrations/       # Arquivos de migration SQL
‚îÇ   ‚îú‚îÄ‚îÄ scripts/          # Scripts para popular o banco
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma     # Defini√ß√£o do schema do Prisma
‚îú‚îÄ‚îÄ src/                  # C√≥digo-fonte da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ application/      # L√≥gica de aplica√ß√£o (controllers, services, routes)
‚îÇ   ‚îú‚îÄ‚îÄ domain/           # Entidades, interfaces e valida√ß√µes (Zod)
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/   # Configura√ß√µes de baixo n√≠vel (DB, servidor, plugins)
‚îÇ   ‚îî‚îÄ‚îÄ tests/            # Testes automatizados
‚îú‚îÄ‚îÄ .eslintrc.json        # Configura√ß√µes do ESLint
‚îú‚îÄ‚îÄ docker-compose.yml    # Arquivo de configura√ß√£o do Docker Compose
‚îú‚îÄ‚îÄ Dockerfile            # Defini√ß√£o do container da API
‚îú‚îÄ‚îÄ package.json          # Depend√™ncias e scripts do projeto
‚îî‚îÄ‚îÄ tsconfig.json         # Configura√ß√µes do TypeScript
```

## üîß Solu√ß√£o de Problemas

1.  **Problemas de conex√£o com o banco:**
    ```bash
    docker-compose restart postgres
    ```

2.  **Resetar o banco de dados (CUIDADO: todos os dados ser√£o perdidos):**
    ```bash
    docker-compose down -v
    docker-compose up -d
    ```

3.  **Visualizar logs dos servi√ßos:**
    ```bash
    docker-compose logs -f
    ```
4.  **Verificar o status das migrations:**
    ```bash
    docker-compose exec api npx prisma migrate status
    ```
